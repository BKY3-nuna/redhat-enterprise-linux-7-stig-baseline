<%
require 'time';
%>
---
driver:
  name: vagrant
  customize:
    natdnsproxy1: "on"
    natdnshostresolver1: "on"

provisioner:
  name: puppet_apply
  sudo: true
  require_chef_for_busser: false
  manifests_path: ./spec/puppet/manifests
  modules_path: ./spec/puppet/modules
  hiera_config_path: ./spec/puppet/hiera.yaml
  hiera_data_path: ./spec/puppet/hiera
  resolve_with_librarian_puppet: true
  ignore_spec_fixtures: true

verifier:
  name: inspec
  sudo: true
  reporter:
    - cli
    - json:spec/results/%{platform}_%{suite}-<%= Time.now.iso8601 %>.json
  inspec_tests:
    - name: RedHat Enterprise Linux 7 STIG
      path: .
      #branch: "v2.6"
  #controls:
  #  - V-72309
  input_files:
    - inputs.example.yml
  inputs:
    disable_slow_controls: true
  load_plugins: true

platforms:
  - name: rhel-7
    lifecycle:
      post_create:
        # - remote: sudo yum upgrade
        - remote: sudo yum install bc bind-utils redhat-lsb-core vim
        - remote: sudo chage -d $(( $( date +%s ) / 86400 )) vagrant
    driver:
      box: bento/centos-7

suites:
  - name: default
    provisioner:
      manifest: stig.pp
    verifier:
      name: inspec
      inputs:
        disable_slow_controls: true
      # inspec_tests:
      #   - name: RedHat Enterprise Linux 7 STIG
      #     git: https://github.com/mitre/redhat-enterprise-linux-7-stig-baseline.git
      #     branch: 'v2.6'
      # #controls:
      # #  - V-72309
      # input_files:
      #   - <%= ENV[('PWD')] %>/inputs.yaml
